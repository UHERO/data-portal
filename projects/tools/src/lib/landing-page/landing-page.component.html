<div class="multi-series-container">
	<ng-template ngFor let-data [ngForOf]="categoryData | async">
		<h2 *ngIf="data.requestComplete && !data.invalid" class="selected-category" [class.search-term]="search"
			id="id_top">
			{{data.selectedCategory.name}}</h2><i (click)="showHelp()" class="bi bi-question-circle display-help-icon"></i>
		<p-dialog header="Category View Help" [(visible)]="displayHelp" [style]="{width: '60vw'}" [modal]="true"
			[dismissableMask]="true">
			<p-tabView>
				<p-tabPanel header="Category View">
					<p>This is the category view of the Data Portal. Use the menu on the left hand side of the screen to display data
						related to each category.</p>
					<img src="assets/category_selectors.png" style="width: 100%;" alt="Category selectors">
					<p>At the top of the page are selectors to change the region and frequency (if applicable) for the series that are
						displayed. Next to
						the selector(s) is a toggle to switch between "Table View" and "Chart View." <em>Note that changing the
							frequency or region may result in a different subset of series being
							displayed in the chart/table view, as not all data are available at all frequencies and for all regions.</em>
						This is followed by a date slider where the date range for the displayed data can be modified to your desired
						starting or ending period. This can be done by either clicking and dragging the handles of the slider or
						manually selecting a date using the input boxes.</p>		
				</p-tabPanel>
				<p-tabPanel header="Chart View">
					<img src="assets/category_chartview.png" style="width: 100%;" alt="Category chart view">
					<p>By default, the Data Portal loads into the Chart View. In the upper left corner of each chart you will find the
						name of the indicator displayed, the date of the last value in the chart (with units in parentheses), and the
						year-over-year percent change (or absolute change where appropriate). Hovering your mouse cursor over a series
						will display values at different points in time. Click on a chart to view more detailed data.</p>
						<p>At the bottom left corner of each chart is a star. When selected, the star outline is
							filled solid and the indicator is added to the Analyzer used for grouping and comparing multiple indicators.</p>
				</p-tabPanel>
				<p-tabPanel header="Table View">
					<img src="assets/category_tableview.png" style="width: 100%;" alt="Category table view">
					<p>In Table View, in addition to the selectors described above, there are toggles for switching back to chart view,
						to display year-over-year percent change (absolute change where appropriate), and year-to-date growth rate for
						indicators at the monthly or quarterly frequency. You can change your sample size using the same controls
						available in Chart View. If the sample selected is too large to fit on the screen, you can scroll the table
						horizontally to display the remaining observations. (Note that in some browsers the horizontal scroll bar is
						hidden until you actually begin scrolling.) The Download CSV link saves a Comma Separated Values formatted file
						of the table to your downloads folder. A CSV file easily loads in Excel or other software programs. Selecting
						the information icon next to the star pops up a box with more information
						about the selected indidator including a description and source links. Click on the name of the indicator to
						view the chart and table of the data.</p>
						<p>Any indicator in the table can be added to the Analyzer by selecting the Analyzer
							star, located to the right of the name of each indicator.</p>
				</p-tabPanel>
			</p-tabView>
		</p-dialog>
		<ng-template ngIf [ngIf]="data.invalid">
			<p>{{data.invalid}}</p>
		</ng-template>
		<div *ngIf="!data.requestComplete && !data.invalid" class="d-flex justify-content-center">
			<div class="spinner-border" role="status">
				<span class="visually-hidden">Loading...</span>
			</div>
		</div>
		<ng-template ngIf [ngIf]="data.requestComplete && !data.invalid && !search">
			<ng-template ngIf [ngIf]="portal.categoryTabs && data.subcategories?.length > 1">
				<ul class="content-links">
					<li *ngFor="let sub of data.subcategories; let subInd='index'">
						<a (click)="navToFirstDataList(sub)"
							[class.current-sub]="sub.id === data.selectedDataList.id">{{sub.name}}</a>
					</li>
				</ul>
				<hr class="sublist-separator">
			</ng-template>
			<ng-template ngIf [ngIf]="!portal.categoryTabs">
				<h3 class="selected-data-list" [class.search-term]="search">
					{{data.selectedDataList.dataListName}}</h3>
			</ng-template>
			<div class="filters">
				<lib-geo-selector [regions]="data.regions"
					(selectedGeoChange)="redrawSeriesGeo($event, selectedFreq, selectedFc)" class="selector">
				</lib-geo-selector>
				<lib-freq-selector [freqs]="data.frequencies"
					(selectedFreqChange)="redrawSeriesFreq($event, selectedGeo, selectedFc)" class="selector">
				</lib-freq-selector>
				<lib-forecast-selector *ngIf="portalSettings.selectors.includes('forecast')" [forecasts]="data.forecasts"
					(selectedFcChange)="redrawSeriesFc($event, selectedGeo, selectedFreq)" class="selector">
				</lib-forecast-selector>
				<a (click)="switchView()" class="btn btn-sm switch-view">{{routeView === 'table' ? 'Chart View' : 'Table View'}}
					<i class="bi" [class.bi-graph-up]="routeView === 'table'"
						[class.bi-table]="routeView === 'chart' || !routeView"></i>
				</a>
				<label *ngIf="routeView === 'table'" class="me-2 form-check-inline">
					<input type="checkbox" [checked]="queryParams.yoy === 'true'" (change)="yoyActive($event)">Year/Year
				</label>
				<label *ngIf="routeView === 'table' && selectedFreq?.freq !== 'A'" class="me-2 form-check-inline">
					<input type="checkbox" [checked]="queryParams.ytd === 'true'" (change)="ytdActive($event)">Year-to-Date
				</label>
				<label *ngIf="data.hasSeasonal" class="form-check-inline">
					<input type="checkbox" name="seasonal_toggle" [checked]="queryParams.sa === 'true'"
						(change)="toggleSASeries($event)">Seasonally Adjusted
				</label>
				<lib-date-slider *ngIf="data.displaySeries" class="sliders" [portalSettings]="portalSettings"
					[dates]="data.categoryDates" [dateFrom]="routeStart || null" [dateTo]="routeEnd || null"
					[freq]="selectedFreq?.freq" (updateRange)="changeRange($event)"></lib-date-slider>
			</div>
		</ng-template>
		<ng-template ngIf [ngIf]="data.requestComplete && !data.noData && seriesRange && !search">
			<lib-category-table-view *ngIf="routeView === 'table'" [portalSettings]="portalSettings"
				[dates]="data.categoryDates" [tableStart]="routeStart" [tableEnd]="routeEnd"
				[selectedCategory]="data.selectedCategory" [selectedDataList]="data.selectedDataList"
				[data]="data.displaySeries" [yoyActive]="queryParams.yoy === 'true'" [ytdActive]="queryParams.ytd === 'true'"
				[noSeries]="data.noData" [params]="queryParams" [showSeasonal]="queryParams.sa === 'true'"
				[hasSeasonal]="data.hasSeasonal">
			</lib-category-table-view>
			<lib-category-charts *ngIf="routeView !== 'table'" [portalSettings]="portalSettings" [routeStart]="routeStart"
				[routeEnd]="routeEnd" [data]="data.displaySeries" [dates]="data.categoryDates" [freq]="selectedFreq?.freq"
				[noSeries]="data.noData" [showSeasonal]="queryParams.sa === 'true'" [hasSeasonal]="data.hasSeasonal"
				[analyzerView]="false" (updateURLFragment)="updateRoute()">
			</lib-category-charts>
		</ng-template>
		<ng-template ngIf [ngIf]="data.requestComplete && data.noData && !search">
			<p class="no-data">No data available for current selection.</p>
		</ng-template>
		<ng-template ngIf [ngIf]="data.requestComplete && !data.noData && search">
			<lib-search-results [searchData]="data"></lib-search-results>
		</ng-template>
	</ng-template>
</div>