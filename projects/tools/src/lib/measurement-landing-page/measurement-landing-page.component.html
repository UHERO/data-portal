<div class="multi-series-container">
	<ng-template ngFor let-data [ngForOf]="categoryData | async">
		<h2 *ngIf="data.requestComplete" class="selected-category" [class.search-term]="search" id="id_top">
			{{data.selectedCategory.name}}</h2><i (click)="showHelp()" class="bi bi-question-circle display-help-icon"></i>
			<p-dialog header="Category View Help" [(visible)]="displayHelp" [style]="{width: '60vw'}" [modal]="true"
				[dismissableMask]="true">
				<p>This is the category view of the Data Portal. Use the menu on the left hand side of the screen to display data
					related to each category.</p>
				<p>At the top of the page are selectors to change the region and frequency (if applicable) for the series that are
					displayed. Next to
					the selector(s) is a toggle to switch between "Table View" and "Chart View." <em>Note that changing the
						frequency or region may result in a different subset of series being
						displayed in the chart/table view, as not all data are available at all frequencies and for all regions.</em>
					This is followed by a date slider where the date range for the displayed data can be modified to your desired
					starting or ending period. This can be done by either clicking and dragging the handles of the slider or
					manually selecting a date using the input boxes.</p>
				<p><strong>Chart View</strong><br />
					By default, the Data Portal loads into the Chart View. In the upper left corner of each chart you will find the
					name of the indicator displayed, the date of the last value in the chart (with units in parentheses), and the
					year-over-year percent change (or absolute change where appropriate). Hovering your mouse cursor over a series
					will display values at different points in time. In the bottom left corner of each chart is a star. When
					selected, the star outline is filled solid and the indicator is added to the Analyzer used for grouping and
					comparing multiple indicators. Click on a chart to view more detailed data.</p>
				<p><strong>Table View</strong><br />
					In Table View, in addition to the selectors described above, there are toggles for switching back to chart view,
					to display year-over-year percent change (absolute change where appropriate), and year-to-date growth rate for
					indicators at the monthly or quarterly frequency. You can change your sample size using the same controls
					available in Chart View. If the sample selected is too large to fit on the screen, you can scroll the table
					horizontally to display the remaining observations. (Note that in some browsers the horizontal scroll bar is
					hidden until you actually begin scrolling.) The Download CSV link saves a Comma Separated Values formatted file
					of the table to your downloads folder. A CSV file easily loads in Excel or other software programs. Any
					indicator in the table can be added to the Analyzer by selecting the Analyzer star, located to the right of the
					name of each indicator. Selecting the information icon next to the star pops up a box with more information
					about the selected indidator including a description and source links. Click on the name of the indicator to
					view the chart and table of the data.</p>
			</p-dialog>
		<p *ngIf="search && data.invalid">No results found for "{{data.invalid}}."</p>
		<p *ngIf="!search && data.invalid">{{data.invalid}}</p>
		<div *ngIf="search && !data.requestComplete && !data.invalid" class="d-flex justify-content-center">
			<div class="spinner-border" role="status">
				<span class="visually-hidden">Loading...</span>
			</div>
		</div>
		<h3 *ngIf="data.requestComplete && !search" class="selected-data-list" [class.search-term]="search">
			{{data.selectedDataList.name}}</h3>
		<div *ngIf="data.requestComplete && !search" class="filters">
			<lib-measurement-selector *ngIf="data.measurements" [measurements]="data.measurements"
				[selectedMeasurement]="data.currentMeasurement" (selectedMeasurementChange)="redrawSeries($event)"
				class="selector">
			</lib-measurement-selector>
			<a (click)="switchView()" class="switch-view">{{routeView === 'table' ? 'Chart View' : 'Table View'}}
				<i class="bi" [class.bi-graph-up]="routeView === 'table'" [class.bi-table]="routeView === 'chart' || !routeView"></i>
			</a>
			<label *ngIf="routeView === 'table'" class="form-check-inline">
				<input type="checkbox" [checked]="queryParams.c5ma === 'true'" (change)="c5maActive($event)">Annual
				Change
			</label>
			<lib-date-slider class="sliders" *ngIf="data.displaySeries" [portalSettings]="portalSettings"
				[dates]="data.categoryDates" [dateFrom]="data?.seriesStart || null"
				[dateTo]="data?.seriesEnd || null" [freq]="data.currentFreq?.freq"
				(updateRange)="changeRange($event, data)"></lib-date-slider>
		</div>
		<div *ngIf="!search && !data.requestComplete && !data.invalid" class="d-flex justify-content-center">
			<div class="spinner-border" role="status">
				<span class="visually-hidden">Loading...</span>
			</div>
		</div>
		<ng-template ngIf [ngIf]="data.requestComplete && !data.noData && data.seriesStart && data.seriesEnd">
			<lib-category-table-view *ngIf="routeView === 'table'" [portalSettings]="portalSettings" [dates]="data.categoryDates"
				[tableStart]="data.seriesStart" [tableEnd]="data.seriesEnd" [data]="data.displaySeries"
				[tableId]="data.selectedDataList" [selectedCategory]="data.selectedCategory"
				[c5maActive]="queryParams.c5ma === 'true'" [noSeries]="data.noData" [params]="queryParams">
			</lib-category-table-view>
			<lib-category-charts *ngIf="routeView !== 'table'" [search]="search" [portalSettings]="portalSettings"
				[routeStart]="data.seriesStart" [routeEnd]="data.seriesEnd" [dates]="data.categoryDates" [data]="data.displaySeries"
				[freq]="data.currentFreq?.freq" [noSeries]="data.noData" [findMinMax]="data.findMinMax"
				(updateURLFragment)="updateRoute()">
			</lib-category-charts>
		</ng-template>
		<ng-template ngIf [ngIf]="data.requestComplete && data.noData && !search">
			<p class="no-data">No data available for current selection.</p>
		</ng-template>
		<ng-template ngIf [ngIf]="data.requestComplete && !data.noData && search">
			<lib-search-results [searchData]="data"></lib-search-results>
		</ng-template>
	</ng-template>
</div>