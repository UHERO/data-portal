<app-search-bar (onSearch)="onSearch($event)"></app-search-bar>
<div class="category-tables">
  <div *ngFor="let data of categoryData | async">
    <h2 class="selected-category" id="id_top">{{data.selectedCategory}}</h2>
    <template ngFor let-sub [ngForOf]="data.sublist">
      <template ngFor let-series [ngForOf]="data.seriesData">
        <div class="table-row" *ngIf="sub.id === series.sublist.id || routeSearch">
          <ul class="content-links" *ngIf="data.sublist.length > 1" [attr.id]="'id_' + series.sublist.id">
            <li *ngFor="let sub of data.sublist">
              <a [routerLink]="['/category/table']" [queryParams]="queryParams" [fragment]="sub.id" (click)="scrollTo()" [class.currentSub]="sub.id === series.sublist.id">{{sub.name}}</a>
            </li>
          </ul>
          <hr class="sublist-separator" *ngIf="data.sublist.length > 1">
          <div class="table-checkboxes">
            <label class="form-check-inline">
              <input class="form-check-input" type="checkbox" (change)="yoyActive($event)">YOY
            </label>
            <label class="form-check-inline">
              <input class="form-check-input" type="checkbox" (change)="ytdActive($event)">YTD
            </label>
          </div>
          <div class="filters">
            <app-geo-selector [regions]="data.regions" [(selectedGeo)]="data.currentGeo" (selectedGeoChange)="redrawTableGeo($event, data.currentFreq)" class="selector"></app-geo-selector>
            <app-freq-selector [freqs]="data.frequencies" [(selectedFreq)]="data.currentFreq" (selectedFreqChange)="redrawTableFreq($event, data.currentGeo)" class="selector"></app-freq-selector>
            <a [routerLink]="['/category']" [queryParams]="queryParams" class="switch-view">Chart View <i class="material-icons md-18">show_chart</i></a>
          </div>
          <p *ngIf="series.dateWrapper && series.seasonallyAdjusted === false">No Seasonally Adjusted Series Available</p>
          <p *ngIf="!series.dateWrapper && !series.seasonallyAdjusted">No Data Available</p>
          <div class="table" #tableScroll on-mouseover="userMouse()" *ngIf="series.dateWrapper && series.seasonallyAdjusted">
            <table class="category-table">
              <!-- row of dates -->
              <tr>
                <th><b>Series</b></th>
                <template ngFor let-date [ngForOf]="series.sublist.dateRange" let-i="index">
                  <td *ngIf="date.date >= series.dateWrapper.firstDate && date.date <= series.dateWrapper.endDate"><b>{{date.tableDate}}</b></td>
                </template>
              </tr>
              <!-- series data -->
              <template ngFor let-serie [ngForOf]="series.series">
                <tr *ngIf="serie.seriesInfo.seasonallyAdjusted !== false && serie.categoryTable">
                  <th>
                    <a [routerLink]="['/series', serie.seriesInfo.id]" [title]="serie.seriesInfo.title">
                      {{serie.seriesInfo.title}}
                    </a>
                    <span class="tag tag-pill tag-primary" *ngIf="serie.seriesInfo.seasonallyAdjusted === true">SA</span>
                  </th>
                  <template ngFor let-item [ngForOf]="serie.categoryTable">
                    <td *ngIf="item.date >= series.dateWrapper.firstDate && item.date <= series.dateWrapper.endDate">{{item.level}}</td>
                  </template>
                </tr>
                <tr *ngIf="serie.seriesInfo.seasonallyAdjusted !== false && serie.categoryTable && yoyIsActive">
                  <th>{{(serie.seriesInfo.percent === true) ? '&emsp; YOY (ch.)' : '&emsp; YOY (%)'}}</th>
                  <template ngFor let-item [ngForOf]="serie.categoryTable">
                    <td *ngIf="item.date >= series.dateWrapper.firstDate && item.date <= series.dateWrapper.endDate">{{item.yoy}}</td>
                  </template>
                </tr>
                <tr *ngIf="serie.seriesInfo.seasonallyAdjusted !== false && serie.categoryTable && ytdIsActive">
                  <th>{{(serie.seriesInfo.percent === true)? '&emsp; YTD (ch.)' : '&emsp; YTD (%)'}}</th>
                  <template ngFor let-item [ngForOf]="serie.categoryTable">
                    <td *ngIf="item.date >= series.dateWrapper.firstDate && item.date <= series.dateWrapper.endDate">{{item.ytd}}</td>
                  </template>
                </tr>
              </template>
            </table>
          </div>
        </div>
      </template>
    </template>
  </div>
</div>